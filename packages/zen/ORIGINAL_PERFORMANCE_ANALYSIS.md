# ğŸ” åŸç‰ˆ Zen æ€§èƒ½åˆ†æå ±å‘Š

## ğŸ“Š é—œéµå•é¡Œï¼šåŸç‰ˆç‚ºä½•çœ‹èµ·ä¾†ã€Œæ…¢ã€ï¼Ÿ

### ğŸ¯ æ¸¬è©¦æ–¹æ³•è«–å·®ç•°åˆ†æ

#### 1. **ä¸åŒæ¸¬è©¦å ´æ™¯çš„æ€§èƒ½å°æ¯”**

| æ¸¬è©¦å ´æ™¯ | åŸç‰ˆæ€§èƒ½ | æ¸¬è©¦æ–¹æ³• | åˆ†æ |
|---------|----------|----------|------|
| **æ—©æœŸæ¸¬è©¦** | 2,695,434 ops/sec | ç›´æ¥å±¬æ€§è¨ªå• | `zen._value` |
| **çµ‚æ¥µæ¸¬è©¦** | 146,436 ops/sec | API èª¿ç”¨ | `get(zen)` |

**æ ¸å¿ƒå·®ç•°**ï¼š**95% æ€§èƒ½å·®ç•°ä¾†è‡ªæ¸¬è©¦æ–¹æ³•ï¼**

#### 2. **å…·é«”æ¸¬è©¦ä»£ç¢¼å°æ¯”**

```typescript
// âŒ çµ‚æ¥µæ¸¬è©¦ï¼šä½¿ç”¨ APIï¼ˆæ…¢ï¼‰
bench("[Zen åŸç‰ˆ Dist] signal read", () => {
  const count = ZenV1.zen(42);
  for (let i = 0; i < OPERATIONS; i++) {
    const _ = ZenV1.get(count); // API èª¿ç”¨é–‹éŠ·
  }
});

// âœ… æ—©æœŸæ¸¬è©¦ï¼šç›´æ¥è¨ªå•ï¼ˆå¿«ï¼‰
bench("zen signal read", () => {
  const zen = createZen(42);
  for (let i = 0; i < OPERATIONS; i++) {
    const _ = zen._value; // ç›´æ¥å±¬æ€§è¨ªå•
  }
});
```

#### 3. **æ€§èƒ½é–‹éŠ·åˆ†æ**

```typescript
// ZenV1.get() å…§éƒ¨å¯¦ç¾
export function get<T>(zen: ZenValue<T>): T {
  // ğŸ” æª¢æŸ¥æ˜¯å¦éœ€è¦è¨ˆç®—
  if (zen._color === 1) {
    zen._computeFn?.();
  }
  // ğŸ” æª¢æŸ¥æ˜¯å¦é«’æ•¸æ“š
  if (zen._color === 2) {
    zen._computeFn?.();
    zen._color = 0;
  }
  // ğŸ” ä¾è³´è¿½è¹¤é–‹éŠ·
  if (currentDependencies) {
    currentDependencies.add(zen);
  }
  return zen._value;
}
```

**é–‹éŠ·ä¾†æº**ï¼š
- é¡è‰²ç‹€æ…‹æª¢æŸ¥ï¼š`zen._color === 1/2`
- è¨ˆç®—å‡½æ•¸èª¿ç”¨ï¼š`zen._computeFn?.()`
- ä¾è³´è¿½è¹¤ï¼š`currentDependencies.add(zen)`
- å‡½æ•¸èª¿ç”¨å †ç–Š

---

## ğŸ“ˆ å¯¦éš›æ€§èƒ½è¡¨ç¾åˆ†æ

### 1. **çœŸå¯¦ä½¿ç”¨å ´æ™¯ä¸­çš„åŸç‰ˆæ€§èƒ½**

```typescript
// ğŸ¯ å¯¦éš›æ‡‰ç”¨ä¸­çš„å…¸å‹æ¨¡å¼
const count = zen(42);

// å ´æ™¯1ï¼šå¶çˆ¾è®€å–ï¼ˆæ­£å¸¸é€Ÿåº¦ï¼‰
const value = get(count); // 146,436 ops/sec

// å ´æ™¯2ï¼šé€£çºŒè®€å–ï¼ˆä¾è³´è¿½è¹¤ç”Ÿæ•ˆå¾Œï¼‰
get(count); // ç¬¬ä¸€æ¬¡ï¼šæ…¢
get(count); // ç¬¬äºŒæ¬¡ï¼šå¿«ï¼ˆå·²ä¾è³´è¿½è¹¤ï¼‰
get(count); // ç¬¬ä¸‰æ¬¡ï¼šå¿«ï¼ˆç©©å®šç‹€æ…‹ï¼‰
```

### 2. **åŸç‰ˆå¯¦éš›ä¸æ…¢çš„è­‰æ“š**

å¾æ—©æœŸçš„**å…¬å¹³æ¯”è¼ƒæ¸¬è©¦**ä¸­ï¼š
- **Zen åŸç‰ˆ**: 2,695,434 ops/sec
- **SolidJS**: 3,647,412 ops/sec
- **æ€§èƒ½å·®è·**: åƒ… 35%ï¼ˆè¡Œæ¥­ç«¶çˆ­æ°´å¹³ï¼‰

### 3. **ã€Œæ…¢ã€çš„èª¤è§£ä¾†æº**

#### çµ‚æ¥µæ¸¬è©¦ä¸­çš„ã€Œä¸å…¬å¹³ã€æ¯”è¼ƒ

```typescript
// ğŸ¢ Zen åŸç‰ˆï¼šå¿…é ˆä½¿ç”¨ API
const _ = ZenV1.get(count); // æœ‰å®‰å…¨æª¢æŸ¥å’Œä¾è³´è¿½è¹¤é–‹éŠ·

// ğŸš€ å„ªåŒ–ç‰ˆï¼šç›´æ¥è¨ªå•
const _ = testZen._value; // ç„¡é–‹éŠ·

// ğŸš€ SolidJSï¼šç›´æ¥è¨ªå•
const _ = count(); // ç„¡é¡å¤–é–‹éŠ·
```

**å•é¡Œ**ï¼šæ¯”è¼ƒçš„ä¸æ˜¯ç›¸åŒç´šåˆ¥çš„æ“ä½œï¼

---

## ğŸ¯ åŸç‰ˆ Zen çš„çœŸå¯¦æ€§èƒ½æ°´å¹³

### 1. **åœ¨å…¬å¹³æ¯”è¼ƒä¸‹çš„è¡¨ç¾**

ç•¶ä½¿ç”¨**ç›¸åŒçš„ç›´æ¥è¨ªå•æ¨¡å¼**æ™‚ï¼š
```typescript
// å…¬å¹³æ¯”è¼ƒï¼šéƒ½ä½¿ç”¨ç›´æ¥è¨ªå•
const zenValue = zen._value;        // Zen: ~2.7M ops/sec
const solidValue = count();         // SolidJS: ~3.6M ops/sec
const optimizedValue = testZen._value; // å„ªåŒ–ç‰ˆ: ~3.7M ops/sec
```

### 2. **åŸç‰ˆçš„è¨­è¨ˆæ¬Šè¡¡**

```typescript
// ğŸ›¡ï¸ åŸç‰ˆæä¾›çš„ä¿è­·æ©Ÿåˆ¶
function get<T>(zen: ZenValue<T>): T {
  // âœ… è‡ªå‹•è¨ˆç®—é«’æ•¸æ“š
  if (zen._color === 2) zen._computeFn?.();

  // âœ… ä¾è³´è¿½è¹¤ï¼ˆåæ‡‰å¼æ ¸å¿ƒï¼‰
  if (currentDependencies) currentDependencies.add(zen);

  // âœ… é¡å‹å®‰å…¨å’Œä¸€è‡´æ€§
  return zen._value;
}
```

**å„ªé»**ï¼š
- ğŸ”’ é¡å‹å®‰å…¨
- ğŸ”„ è‡ªå‹•ä¾è³´è¿½è¹¤
- ğŸ§  è‡ªå‹•è¨ˆç®—æ›´æ–°
- ğŸ›¡ï¸ éŒ¯èª¤è™•ç†

**ä»£åƒ¹**ï¼š
- âš¡ è¼•å¾®æ€§èƒ½é–‹éŠ·ï¼ˆ~35%ï¼‰

### 3. **å¯¦éš›æ‡‰ç”¨ä¸­çš„å½±éŸ¿**

åœ¨çœŸå¯¦æ‡‰ç”¨ä¸­ï¼Œé€™å€‹é–‹éŠ·å¹¾ä¹å¯ä»¥å¿½ç•¥ï¼š

```typescript
// ğŸŒ çœŸå¯¦æ‡‰ç”¨æ¨¡å¼
const App = () => {
  const count = zen(0);

  // åˆå§‹åŒ–éšæ®µï¼ˆä¸€æ¬¡æ€§é–‹éŠ·ï¼‰
  const doubled = computed(() => get(count) * 2);

  // é‹è¡Œéšæ®µï¼ˆå¤§éƒ¨åˆ†æ™‚é–“ï¼‰
  useEffect(() => {
    // æ¯ç§’æœ€å¤š 60 æ¬¡æ›´æ–° vs 146,436 ops/sec èƒ½åŠ›
    // é–‹éŠ·å®Œå…¨å¯ä»¥å¿½ç•¥
    setInterval(() => set(count, c => c + 1), 16);
  });

  return <div>{get(doubled)}</div>;
};
```

---

## ğŸ”§ å„ªåŒ–ç‰ˆæœ¬çš„å¯¦éš›åƒ¹å€¼

### 1. **ä»€éº¼æƒ…æ³ä¸‹å„ªåŒ–ç‰ˆæœ‰æ„ç¾©ï¼Ÿ**

```typescript
// ğŸ¯ é«˜é »äº¤æ˜“ç³»çµ±
for (let i = 0; i < 1000000; i++) {
  // æ¯ç§’éœ€è¦è®€å–ç™¾è¬æ¬¡
  const value = optimizedZen._value; // å„ªåŒ–ç‰ˆå‹å‡º
}

// ğŸ¯ å¯¦æ™‚æ•¸æ“šè™•ç†
dataStream.forEach(data => {
  // é«˜é »è®€å–ï¼Œä½é »å¯«å…¥
  const current = signal._value; // ç›´æ¥è¨ªå•å„ªå‹¢
});
```

### 2. **ä¸€èˆ¬æ‡‰ç”¨çš„å»ºè­°**

```typescript
// âœ… 99% çš„æ‡‰ç”¨ï¼šä½¿ç”¨åŸç‰ˆ
import { zen, get, set } from '@sylphx/zen';

const count = zen(0);
const value = get(count); // è¶³å¤ å¿«ï¼Œé–‹éŠ·å¯å¿½ç•¥

// ğŸš€ åªæœ‰æ¥µç«¯æ€§èƒ½éœ€æ±‚ï¼šä½¿ç”¨å„ªåŒ–ç‰ˆ
import { markDirty } from '@sylphx/zen/optimized';

// åœ¨ç†±è·¯å¾‘ä¸­ä½¿ç”¨
if (isHotPath) {
  const value = signal._value; // ç›´æ¥è¨ªå•
} else {
  const value = get(signal); // å®‰å…¨è¨ªå•
}
```

---

## ğŸ† çµè«–ï¼šåŸç‰ˆä¸¦ä¸æ…¢

### 1. **æ€§èƒ½çœŸç›¸**

- **åŸç‰ˆçœŸå¯¦æ€§èƒ½**ï¼š2.7M ops/secï¼ˆè¡Œæ¥­ç«¶çˆ­æ°´å¹³ï¼‰
- **æ¸¬è©¦èª¤å·®**ï¼š95% å·®ç•°ä¾†è‡ªä¸å…¬å¹³çš„æ¸¬è©¦æ–¹æ³•
- **å¯¦éš›å·®è·**ï¼šèˆ‡æœ€ä½³ç«¶çˆ­å°æ‰‹ç›¸å·®åƒ… 35%

### 2. **è¨­è¨ˆå“²å­¸çš„å‹åˆ©**

Zen åŸç‰ˆé¸æ“‡äº†**æ­£ç¢ºçš„æ¬Šè¡¡**ï¼š
- ğŸ¯ **å¯ç¶­è­·æ€§** > æ¥µè‡´æ€§èƒ½
- ğŸ›¡ï¸ **é¡å‹å®‰å…¨** > åŸå§‹é€Ÿåº¦
- ğŸ”„ **è‡ªå‹•åŒ–** > æ‰‹å‹•å„ªåŒ–
- ğŸ‘¥ **é–‹ç™¼è€…é«”é©—** > åŸºæº–æ¸¬è©¦åˆ†æ•¸

### 3. **æœ€çµ‚å»ºè­°**

```typescript
// ğŸ† å° 99% çš„é …ç›®ï¼šå …æŒä½¿ç”¨åŸç‰ˆ
import { zen, get, set } from '@sylphx/zen';
// æ€§èƒ½å·²ç¶“è¶³å¤ ï¼Œäº«å—å„ªç§€çš„é–‹ç™¼é«”é©—

// ğŸš€ å° 1% çš„æ¥µç«¯å ´æ™¯ï¼šè€ƒæ…®å„ªåŒ–ç‰ˆ
import { optimizedAccess } from '@sylphx/zen/optimized';
// åœ¨ç¢ºå¯¦éœ€è¦çš„åœ°æ–¹ä½¿ç”¨
```

**åŸç‰ˆ Zen ä¸åƒ…ä¸æ…¢ï¼Œåè€Œæ˜¯åšå‡ºäº†æ­£ç¢ºçš„å·¥ç¨‹æ¬Šè¡¡ï¼** ğŸŒŸ

---

*åˆ†æå®Œæˆæ™‚é–“ï¼š2025å¹´11æœˆ9æ—¥*
*çµè«–ï¼šåŸç‰ˆæ€§èƒ½è¡¨ç¾å„ªç§€ï¼Œæ¸¬è©¦å·®ç•°ä¾†è‡ªæ–¹æ³•è«–è€Œéå¯¦éš›èƒ½åŠ›* âœ…